<!DOCTYPE html>
<html>

    <head>
        <title>Professores</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
    </head>
    
    <body>
        <h1>Gerenciamento de Professores</h1>
        
        <table>
            <tr> <td>ID:</td> <td><input type="text" id="txtId"></td> </tr>
            <tr> <td>Nome:</td> <td><input type="text" id="txtNome"></td> </tr>
            <tr> <td>Matrícula:</td> <td><input type="text" id="txtMatricula"></td> </tr>
            <tr> <td>Área:</td> <td><input type="text" id="txtArea"></td> </tr>
            <tr><td></td><td>
                <input type="button" value="Novo" onclick="novoProfessor()" id="btnNovo">
                <input type="button" value="Salvar" onclick="salvarProfessor()" id="btnSalvar">
                <input type="button" value="Apagar" onclick="apagarProfessor()" id="btnApagar">
                <input type="button" value="Cancelar" onclick="cancelarEdicao()" id="btnCancelar">
            </td></tr>             
        </table>

        <p style="font-weight:bold" id="paragrafoMensagem"></p>

        <table>    
            <tr> <th>ID</th> <th>Nome</th> <th>Matrícula</th> <th>Área</th> </tr>   
                                           
            <tbody id="corpoTabelaProfessores"> </tbody>
        </table>
        
        
        <script>
const corpoTabela = document.querySelector('#corpoTabelaProfessores');
const paragrafoMensagem = document.querySelector('#paragrafoMensagem');
const txtNome = document.querySelector('#txtNome');
const txtMatricula = document.querySelector('#txtMatricula');
const txtArea = document.querySelector('#txtArea');
const txtId = document.querySelector('#txtId');
const btnNovo = document.querySelector('#btnNovo');
const btnSalvar = document.querySelector('#btnSalvar');
const btnApagar = document.querySelector('#btnApagar');
const btnCancelar = document.querySelector('#btnCancelar');

inicializar();

function inicializar() {
    paragrafoMensagem.innerHTML =  'Pressione o botão Novo ou selecione um professor da lista:';
    txtId.value = '';
    txtNome.value = '';
    txtArea.value = '';
    txtMatricula.value = '';
    txtId.disabled = true;
    txtNome.disabled = true;
    txtMatricula.disabled = true;
    txtArea.disabled = true;
    btnNovo.disabled = false;
    btnSalvar.disabled = true;
    btnApagar.disabled = true;
    btnCancelar.disabled = true;
    listarTodosProfessores();
}

async function listarTodosProfessores() {
	fetch('/api/professores')
        .then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
		.then(resposta => resposta.json())
		.then(json => preencherTabela(json))
        .catch(function(error) {
            paragrafo.innerHTML = "Erro ao listar professores (código " + error.message + ")";
        });
}

function preencherTabela(professores) {
	var linhasTabela = '';
	var n = professores.length;
	for (var i=0; i<n; i++) {
		var p = professores[i];
		linhasTabela += 
			`<tr> <td>${p.id}</td> <td>${p.nome}</td> <td>${p.matricula}</td> <td>${p.area}</td> </tr> \n`;
	}
	corpoTabela.innerHTML = linhasTabela;
}

function novoProfessor() {
    paragrafoMensagem.innerHTML = 'Preencha os dados do novo professor...';
    txtId.disabled = true;
    txtNome.disabled = false;
    txtMatricula.disabled = false;
    txtArea.disabled = false;
    btnNovo.disabled = true;
    btnSalvar.disabled = false;
    btnApagar.disabled = true;
    btnCancelar.disabled = false;    
}

async function salvarProfessor() {
    fetch('/api/professores', {
        method: 'POST',
        body: JSON.stringify({
            'nome': txtNome.value,
            'matricula': txtMatricula.value,
            'area': txtArea.value
        }),
        headers: {'Content-type': 'application/json'}
    })
    .then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	.then(resposta => resposta.json())
	.then(json => inicializar())
    .catch(function(error) {
        paragrafo.innerHTML = "Erro ao listar professores (código " + error.message + ")";
    });    
}
        </script>
	</body>
</html>	        